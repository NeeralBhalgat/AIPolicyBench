╔══════════════════════════════════════════════════════════════════════════════╗
║                    AIPolicyBench A2A Architecture                             ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                              USER INTERFACE                                  │
│                                                                              │
│    ┌──────────────┐         ┌──────────────┐         ┌──────────────┐     │
│    │  main.py     │         │  launcher.py │         │  Original    │     │
│    │              │         │              │         │  Interface   │     │
│    │  Commands:   │         │  Orchestrate │         │              │     │
│    │  - green     │────────▶│  Evaluation  │         │  green_agent/│     │
│    │  - white     │         │              │         │  agent.py    │     │
│    │  - launch    │         │              │         │              │     │
│    │  - info      │         │              │         │  (CLI mode)  │     │
│    └──────────────┘         └──────┬───────┘         └──────────────┘     │
└───────────────────────────────────┼──────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │   Start Both Agents           │
                    │   Send Evaluation Task        │
                    │   Collect Results             │
                    │   Cleanup                     │
                    └───────────────┬───────────────┘
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        │                           │                           │
        ▼                           ▼                           ▼
┌───────────────────┐     ┌──────────────────┐     ┌───────────────────┐
│   GREEN AGENT     │     │   WHITE AGENT    │     │   A2A PROTOCOL    │
│   (Evaluator)     │────▶│   (RAG System)   │     │                   │
│                   │◀────│                  │     │   HTTP/JSON       │
│  Port: 9001       │     │  Port: 9002      │     │   Messages        │
│                   │     │                  │     │   Agent Cards     │
│  green_agent/     │     │  white_agent/    │     │   Tasks/Contexts  │
│  a2a_evaluator.py │     │  agent.py        │     │                   │
│                   │     │                  │     │   utils/          │
│  Config:          │     │  Config:         │     │   a2a_client.py   │
│  green_agent.toml │     │  white_agent.toml│     │                   │
└─────────┬─────────┘     └─────────┬────────┘     └───────────────────┘
          │                         │
          │                         │
          ▼                         ▼
┌─────────────────┐        ┌──────────────────┐
│  EVALUATION     │        │  RAG PIPELINE    │
│                 │        │                  │
│  - Load queries │        │  1. Retrieve     │
│  - Send to      │        │  2. Rank         │
│    white agent  │        │  3. Augment      │
│  - Receive      │        │  4. Generate     │
│    responses    │        │                  │
│  - Evaluate     │        │  Vector DB:      │
│  - Calculate    │        │  TF-IDF          │
│    metrics      │        │                  │
│                 │        │  LLM:            │
│  evaluation.py  │        │  DeepSeek/       │
│  - Rule-based   │        │  OpenAI/         │
│  - LLM judge    │        │  Anthropic       │
└─────────────────┘        └──────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            DATA FLOW                                         │
└─────────────────────────────────────────────────────────────────────────────┘

  1. User runs: python main.py launch
                        │
                        ▼
  2. Launcher starts Green Agent (port 9001)
                        │
                        ▼
  3. Launcher starts White Agent (port 9002)
                        │
                        ▼
  4. Launcher sends evaluation task to Green Agent:
     <white_agent_url>http://localhost:9002</white_agent_url>
     <queries_file>data/predefined_queries.json</queries_file>
                        │
                        ▼
  5. Green Agent loads queries from JSON file
                        │
                        ▼
  6. For each query:
     Green Agent ──[A2A Message]──▶ White Agent: "What datasets exist for AI safety?"
                        │
                        ▼
  7. White Agent performs RAG:
     - Retrieves relevant documents from vector DB
     - Generates response using LLM
                        │
                        ▼
  8. White Agent ──[A2A Response]──▶ Green Agent: "The following datasets..."
                        │
                        ▼
  9. Green Agent evaluates response:
     - Compare with ground truth
     - Classify: Correct / Miss / Hallucination
                        │
                        ▼
 10. Green Agent ──[Results]──▶ Launcher
                        │
                        ▼
 11. Launcher displays metrics:
     - Correct Rate: 71.43%
     - Hallucination Rate: 14.29%
     - Factuality Rate: 85.71%
                        │
                        ▼
 12. Launcher terminates both agents


┌─────────────────────────────────────────────────────────────────────────────┐
│                         FILE STRUCTURE                                       │
└─────────────────────────────────────────────────────────────────────────────┘

AIPolicyBench/
├── main.py                          # ⭐ NEW: CLI entry point
├── launcher.py                      # ⭐ NEW: Evaluation coordinator
│
├── green_agent/
│   ├── __init__.py                  # ⭐ NEW: Module exports
│   ├── agent.py                     # Original interface (unchanged)
│   ├── a2a_evaluator.py            # ⭐ NEW: A2A evaluator
│   ├── green_agent.toml            # ⭐ NEW: Agent card
│   └── evaluation.py                # Existing (reused)
│
├── white_agent/
│   ├── __init__.py                  # ⭐ NEW: Module exports
│   ├── agent.py                     # ⭐ NEW: A2A RAG agent
│   └── white_agent.toml            # ⭐ NEW: Agent card
│
├── utils/
│   ├── __init__.py                  # ⭐ NEW
│   ├── a2a_client.py               # ⭐ NEW: A2A communication
│   ├── parsing.py                   # ⭐ NEW: Tag parsing
│   └── llm_client.py               # ⭐ MOVED: From white_agent/
│
├── data/
│   └── predefined_queries.json      # Existing
│
├── vector_db/
│   └── safety_datasets_tfidf_db.pkl # Existing
│
├── test_a2a_imports.py             # ⭐ NEW: Import tests
├── A2A_README.md                    # ⭐ NEW: Full documentation
├── A2A_QUICKSTART.md               # ⭐ NEW: Quick start guide
├── A2A_IMPLEMENTATION_SUMMARY.md   # ⭐ NEW: This summary
├── A2A_ARCHITECTURE.txt            # ⭐ NEW: Visual diagram
│
└── requirements.txt                 # ⭐ UPDATED: Added A2A deps

⭐ = New or modified files


┌─────────────────────────────────────────────────────────────────────────────┐
│                      EVALUATION METRICS                                      │
└─────────────────────────────────────────────────────────────────────────────┘

Input: Predefined queries with ground truth answers
       ┌─────────────────────────────────────────┐
       │ Query: "What datasets for AI safety?"   │
       │ Ground Truth: "yes"                     │
       └─────────────────────────────────────────┘
                        │
                        ▼
       White Agent generates response
                        │
                        ▼
       Green Agent evaluates ──▶ Classification:
                                  │
                    ┌─────────────┼─────────────┐
                    │             │             │
                    ▼             ▼             ▼
              ┌──────────┐  ┌──────────┐  ┌──────────┐
              │ CORRECT  │  │   MISS   │  │HALLUCIN- │
              │          │  │          │  │  ATION   │
              │ Contains │  │ Expresses│  │ Wrong    │
              │ ground   │  │ uncertain│  │ answer   │
              │ truth    │  │ ty       │  │          │
              └──────────┘  └──────────┘  └──────────┘
                    │             │             │
                    └─────────────┼─────────────┘
                                  ▼
                         Calculate Metrics:
                         • Correct Rate
                         • Miss Rate
                         • Hallucination Rate
                         • Factuality Rate
                             (Correct + Miss)

